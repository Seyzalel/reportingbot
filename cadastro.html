<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cadastro — Reporting Bot</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{--primary:#6366f1;--secondary:#8b5cf6;--accent:#ec4899;--light:#ffffff;--paper:rgba(255,255,255,.72);--line:#e5e7eb;--ink:#0f172a;--muted:#64748b;--bg1:#f8fafc;--bg2:#eef2f7}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}
body{min-height:100vh;display:flex;flex-direction:column;background:radial-gradient(1200px 600px at 10% -10%,#e9d5ff22,transparent),radial-gradient(1200px 600px at 110% 30%,#93c5fd26,transparent),linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--ink)}
.container{max-width:520px;width:100%;margin:0 auto;padding:40px 20px}
.header{display:flex;flex-direction:column;align-items:center;gap:14px;margin:34px 0 22px}
.logo{width:72px;height:72px;border-radius:18px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary),var(--secondary));box-shadow:0 20px 40px -20px rgba(99,102,241,.5)}
.logo i{font-size:30px;color:#fff}
.brand{font-size:1.7rem;font-weight:800;letter-spacing:-.2px;background:linear-gradient(90deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.card{position:relative;background:var(--paper);border:1px solid var(--line);border-radius:22px;padding:28px 26px;backdrop-filter:blur(8px);box-shadow:0 30px 70px -20px rgba(2,6,23,.15)}
.card:before{content:"";position:absolute;inset:-1;border-radius:24px;background:linear-gradient(120deg,transparent,rgba(99,102,241,.18),transparent);z-index:-1;filter:blur(6px)}
.card h1{font-size:1.35rem;margin-bottom:6px}
.subtitle{font-size:.95rem;color:var(--muted);margin-bottom:18px}
.form{display:flex;flex-direction:column;gap:14px}
.field{display:flex;flex-direction:column;gap:6px}
.label{font-weight:600;font-size:.95rem}
.input-wrap{position:relative}
.input{width:100%;padding:14px 48px 14px 44px;border:2px solid var(--line);border-radius:14px;background:#fff;outline:none;font-size:1rem;transition:border-color .15s,box-shadow .15s}
.input:focus{border-color:var(--primary);box-shadow:0 0 0 6px rgba(99,102,241,.12)}
.icon-left{position:absolute;left:14px;top:50%;transform:translateY(-50%);font-size:1rem;color:var(--muted)}
.icon-right{position:absolute;right:14px;top:50%;transform:translateY(-50%);font-size:1rem;color:var(--muted);cursor:pointer}
.error{font-size:.85rem;color:#ef4444;min-height:18px}
.meter{height:8px;background:#f1f5f9;border:1px solid #e5e7eb;border-radius:999px;overflow:hidden}
.meter>span{display:block;height:100%;width:0;transition:width .25s;background:linear-gradient(90deg,#ef4444,#f59e0b,#10b981)}
.actions{display:flex;flex-direction:column;gap:12px;margin-top:8px}
.btn{width:100%;padding:14px 16px;border:none;border-radius:14px;font-weight:800;font-size:1rem;color:#fff;background:linear-gradient(90deg,var(--primary),var(--secondary));cursor:pointer;transition:transform .15s,box-shadow .15s;box-shadow:0 15px 30px -10px rgba(99,102,241,.4)}
.btn:active{transform:translateY(1px)}
.helper{font-size:.92rem;color:var(--muted);text-align:center}
.helper a{text-decoration:none;color:var(--primary);font-weight:600}
.toast{position:fixed;left:50%;top:20px;transform:translateX(-50%) translateY(-20px);opacity:0;z-index:50;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:0 20px 50px -20px rgba(2,6,23,.25);padding:12px 16px;font-weight:600;display:flex;align-items:center;gap:10px;transition:opacity .25s,transform .25s}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
footer{text-align:center;margin-top:auto;background:#fff;border-top:1px solid var(--line);padding:22px 12px;color:var(--muted);font-size:.95rem}
@media (max-width:420px){.container{padding:28px 16px}.card{padding:22px}.input{padding:13px 46px 13px 42px}}
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <div class="logo"><i class="fas fa-robot"></i></div>
    <div class="brand">Reporting Bot</div>
  </header>

  <section class="card">
    <h1>Criar conta</h1>
    <div class="subtitle">Preencha os dados para começar</div>
    <form id="signup" class="form" novalidate>
      <div class="field">
        <label class="label" for="username">Nome de usuário</label>
        <div class="input-wrap">
          <i class="fa-regular fa-user icon-left"></i>
          <input class="input" id="username" name="username" type="text" inputmode="latin" autocomplete="username" minlength="3" maxlength="32" required>
        </div>
        <div id="err-u" class="error"></div>
      </div>

      <div class="field">
        <label class="label" for="email">E-mail</label>
        <div class="input-wrap">
          <i class="fa-regular fa-envelope icon-left"></i>
          <input class="input" id="email" name="email" type="email" inputmode="email" autocomplete="email" required>
        </div>
        <div id="err-e" class="error"></div>
      </div>

      <div class="field">
        <label class="label" for="password">Senha</label>
        <div class="input-wrap">
          <i class="fa-solid fa-lock icon-left"></i>
          <input class="input" id="password" name="password" type="password" autocomplete="new-password" minlength="8" required>
          <i id="toggle-pw" class="fa-regular fa-eye icon-right" aria-hidden="true"></i>
        </div>
        <div class="meter"><span id="meter"></span></div>
        <div id="err-p" class="error"></div>
      </div>

      <div class="field">
        <label class="label" for="confirm">Confirmar senha</label>
        <div class="input-wrap">
          <i class="fa-solid fa-shield-halved icon-left"></i>
          <input class="input" id="confirm" name="confirm" type="password" autocomplete="new-password" minlength="8" required>
          <i id="toggle-cf" class="fa-regular fa-eye icon-right" aria-hidden="true"></i>
        </div>
        <div id="err-c" class="error"></div>
      </div>

      <div class="actions">
        <button id="submit" class="btn" type="submit"><i class="fa-solid fa-user-plus"></i>&nbsp;Criar conta</button>
        <div class="helper">Já tem conta? <a href="/login">Entrar</a></div>
      </div>
    </form>
  </section>
</div>

<div id="toast" class="toast"><i class="fa-solid fa-circle-check" style="color:#10b981"></i><span>Conta criada com sucesso</span></div>

<footer>
  <p>Reporting Bot © 2025 — Todos os direitos reservados</p>
</footer>

<script>
const f=document.getElementById('signup');
const u=document.getElementById('username');
const e=document.getElementById('email');
const p=document.getElementById('password');
const c=document.getElementById('confirm');
const errU=document.getElementById('err-u');
const errE=document.getElementById('err-e');
const errP=document.getElementById('err-p');
const errC=document.getElementById('err-c');
const btn=document.getElementById('submit');
const toast=document.getElementById('toast');
const toastIcon=toast.querySelector('i');
const toastText=toast.querySelector('span');
const meter=document.getElementById('meter');
const togglePw=document.getElementById('toggle-pw');
const toggleCf=document.getElementById('toggle-cf');

function validUsername(v){return /^[a-zA-Z0-9._]{3,32}$/.test(v)}
function validEmail(v){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)}
function scorePassword(v){let s=0;if(v.length>=8)s++;if(/[A-Z]/.test(v))s++;if(/[a-z]/.test(v))s++;if(/[0-9]/.test(v))s++;if(/[^A-Za-z0-9]/.test(v))s++;if(v.length>=12)s++;return Math.min(s,5)}
function setMeter(v){const s=scorePassword(v);const pct=[0,20,40,60,80,100][s];meter.style.width=pct+'%'}
function clearErrors(){errU.textContent='';errE.textContent='';errP.textContent='';errC.textContent=''}
function validate(){let ok=true;clearErrors();const uv=u.value.trim();const ev=e.value.trim();const pv=p.value;const cv=c.value;if(!validUsername(uv)){errU.textContent='Use 3–32 caracteres: letras, números, ponto ou _';ok=false}if(!validEmail(ev)){errE.textContent='E-mail inválido';ok=false}if(pv.length<8){errP.textContent='Mínimo de 8 caracteres';ok=false}if(cv!==pv||cv.length===0){errC.textContent='As senhas não coincidem';ok=false}btn.disabled=!ok;btn.style.opacity=ok?'1':'.65';return ok}
function showToast(msg,type){toastText.textContent=msg;if(type==='error'){toastIcon.classList.remove('fa-circle-check');toastIcon.classList.add('fa-circle-xmark');toastIcon.style.color='#ef4444'}else{toastIcon.classList.remove('fa-circle-xmark');toastIcon.classList.add('fa-circle-check');toastIcon.style.color='#10b981'}toast.classList.add('show');setTimeout(()=>{toast.classList.remove('show')},1700)}
function setLoading(v){if(v){btn.disabled=true;btn.style.opacity='.65';btn.dataset.label=btn.innerHTML;btn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>&nbsp;Criando...'}else{btn.disabled=false;btn.style.opacity='1';if(btn.dataset.label)btn.innerHTML=btn.dataset.label}}

[u,e,p,c].forEach(x=>x.addEventListener('input',()=>{setMeter(p.value);validate()}));
togglePw.addEventListener('click',()=>{const t=p.getAttribute('type')==='password'?'text':'password';p.setAttribute('type',t);togglePw.classList.toggle('fa-eye');togglePw.classList.toggle('fa-eye-slash')});
toggleCf.addEventListener('click',()=>{const t=c.getAttribute('type')==='password'?'text':'password';c.setAttribute('type',t);toggleCf.classList.toggle('fa-eye');toggleCf.classList.toggle('fa-eye-slash')});

f.addEventListener('submit',async ev=>{
ev.preventDefault();
if(!validate()){if(errU.textContent)u.focus();else if(errE.textContent)e.focus();else if(errP.textContent)p.focus();else if(errC.textContent)c.focus();return}
setLoading(true);
try{
const res=await fetch('/register',{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},credentials:'same-origin',body:JSON.stringify({username:u.value.trim(),email:e.value.trim(),password:p.value,confirm:c.value})});
const data=await res.json().catch(()=>({}));
if(res.ok&&data&&data.ok){showToast('Conta criada com sucesso','success');setTimeout(()=>{window.location.href=data.redirect||'/'},800);return}
clearErrors();
if(data&&data.field==='username')errU.textContent=data.error||'Erro no nome de usuário';
else if(data&&data.field==='email')errE.textContent=data.error||'Erro no e-mail';
else if(data&&data.field==='password')errP.textContent=data.error||'Erro na senha';
else if(data&&data.field==='confirm')errC.textContent=data.error||'Erro na confirmação';
else if(res.status===409){const m=(data&&data.error)||'Usuário ou e-mail já cadastrado';errU.textContent=m;errE.textContent=m}
else{showToast((data&&data.error)||'Não foi possível criar a conta','error')}
if(errU.textContent)u.focus();else if(errE.textContent)e.focus();else if(errP.textContent)p.focus();else if(errC.textContent)c.focus()
}catch(e){
showToast('Falha de conexão. Tente novamente.','error')
}finally{
setLoading(false)
}
});

setMeter('');
validate();
</script>
</body>
</html>