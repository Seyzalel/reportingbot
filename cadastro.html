<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cadastro — Reporting Bot</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
<style>
:root{
  --bg:#07070a;
  --panel:#0f1115;
  --panel-2:#14151a;
  --card:#0f1318;
  --glass: rgba(255,255,255,0.02);
  --accent-1:#8b5cf6;
  --accent-2:#6366f1;
  --accent-3:#ec4899;
  --muted:#99a4b5;
  --text:#e6eef8;
  --success:#10b981;
  --danger:#ef4444;
  --line: rgba(255,255,255,0.04);
  --radius:14px;
  --pad: clamp(.75rem,1.6vw,1.1rem);
  --fs-base: 13px;
  --shadow: 0 26px 60px -28px rgba(0,0,0,0.8);
  --glass-2: rgba(255,255,255,0.015);
}
html{font-size:var(--fs-base)}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:
  radial-gradient(900px 560px at -10% -10%, rgba(139,92,246,0.06), transparent),
  radial-gradient(900px 580px at 110% 30%, rgba(99,102,241,0.04), transparent),
  linear-gradient(180deg,var(--bg),var(--panel));color:var(--text);-webkit-font-smoothing:antialiased}
.container{max-width:980px;margin:28px auto;padding:18px;display:grid;gap:18px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.brand{display:flex;align-items:center;gap:12px}
.brand-badge{width:52px;height:52px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));box-shadow:0 18px 45px -18px rgba(99,102,241,.25)}
.brand-badge i{color:#fff;font-size:20px}
.brand-title{font-weight:800;font-size:1.05rem;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));-webkit-background-clip:text;background-clip:text;color:transparent}
.hint{color:var(--muted);font-size:.86rem}
.layout{display:grid;grid-template-columns:1fr 340px;gap:18px;align-items:start}
@media(max-width:980px){.layout{grid-template-columns:1fr}}
.card{background:linear-gradient(180deg,var(--card),var(--panel-2));border:1px solid var(--line);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);overflow:hidden}
.form-title{display:flex;align-items:center;gap:12px;font-weight:900;font-size:1.05rem}
.sub{color:var(--muted);margin-top:6px;font-size:.9rem}
.form{display:grid;gap:12px;margin-top:12px}
.row{display:grid;gap:8px}
.label{font-weight:800;color:var(--muted);display:flex;align-items:center;gap:10px;font-size:.92rem}
.input-wrap{position:relative}
.input{width:100%;padding:12px 44px 12px 44px;border-radius:12px;background:var(--glass-2);border:1px solid rgba(255,255,255,0.02);color:var(--text);outline:0;font-weight:700;font-size:.95rem}
.input::placeholder{color:rgba(230,238,248,0.45);font-weight:600}
.input:focus{box-shadow:0 8px 30px -20px rgba(99,102,241,.25);border-color:rgba(99,102,241,.18)}
.icon-left,.icon-right{position:absolute;top:50%;transform:translateY(-50%);color:var(--muted);font-size:0.95rem}
.icon-left{left:12px}
.icon-right{right:12px;cursor:pointer}
.error{min-height:18px;color:var(--danger);font-size:.88rem;font-weight:700}
.meter{height:8px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);overflow:hidden;margin-top:8px}
.meter span{display:block;height:100%;width:0;background:linear-gradient(90deg,#ef4444,#f59e0b,#10b981);transition:width .25s}
.controls{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:6px}
.terms{font-size:.92rem;color:var(--muted);line-height:1.25}
.terms a{color:var(--accent-2);font-weight:800}
.actions{display:grid;gap:10px;margin-top:8px}
.btn{padding:12px;border-radius:12px;border:none;font-weight:900;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#fff;cursor:pointer;box-shadow:0 16px 40px -20px rgba(99,102,241,.28);font-size:.95rem}
.btn[disabled]{opacity:.6;cursor:not-allowed}
.alt{background:transparent;border:1px solid var(--line);color:var(--text);padding:10px;border-radius:10px;font-weight:800}
.panel{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.015));border:1px solid rgba(255,255,255,0.02);padding:14px;border-radius:12px}
.panel h4{margin:0;font-size:.98rem;font-weight:900}
.panel p{margin-top:8px;color:var(--muted);font-size:.9rem}
.tiny{font-size:.82rem;color:var(--muted)}
.footer{margin-top:18px;text-align:center;color:var(--muted);font-size:.82rem}
.toast{position:fixed;left:50%;top:18px;transform:translateX(-50%) translateY(-12px);opacity:0;z-index:90;background:linear-gradient(180deg,rgba(20,20,20,0.95),rgba(10,10,10,0.95));border-radius:10px;padding:10px 14px;font-weight:900;display:flex;align-items:center;gap:10px;color:var(--text);transition:opacity .22s,transform .22s}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
@media (prefers-reduced-motion: reduce){
  .card{transition:none}
  .input{transition:none}
  .toast{transition:none}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand">
      <div class="brand-badge" aria-hidden="true"><i class="fa-solid fa-robot"></i></div>
      <div>
        <div class="brand-title">Reporting Bot</div>
        <div class="hint">Crie sua conta e gerencie suas denúncias</div>
      </div>
    </div>
  </div>

  <div class="layout">
    <main class="card" aria-labelledby="signup-heading">
      <div class="form-title" id="signup-heading"><i class="fa-solid fa-user-plus" aria-hidden="true"></i><span style="margin-left:8px">Criar conta</span></div>
      <div class="sub">Preencha os dados para começar</div>

      <form id="signup" class="form" novalidate>
        <div class="row">
          <label class="label" for="username"><i class="fa-solid fa-user" aria-hidden="true"></i> Nome de usuário</label>
          <div class="input-wrap">
            <i class="fa-solid fa-user icon-left" aria-hidden="true"></i>
            <input id="username" name="username" class="input" type="text" inputmode="latin" autocomplete="username" minlength="3" maxlength="32" required aria-describedby="errU" placeholder="ex.: seunome" />
            <i class="fa-solid fa-circle-check icon-right" id="okU" style="opacity:0" aria-hidden="true"></i>
          </div>
          <div id="errU" class="error" aria-live="polite"></div>
        </div>

        <div class="row">
          <label class="label" for="email"><i class="fa-regular fa-envelope" aria-hidden="true"></i> E-mail</label>
          <div class="input-wrap">
            <i class="fa-regular fa-envelope icon-left" aria-hidden="true"></i>
            <input id="email" name="email" class="input" type="email" inputmode="email" autocomplete="email" required aria-describedby="errE" placeholder="voce@exemplo.com" />
            <i class="fa-solid fa-circle-check icon-right" id="okE" style="opacity:0" aria-hidden="true"></i>
          </div>
          <div id="errE" class="error" aria-live="polite"></div>
        </div>

        <div class="row">
          <label class="label" for="password"><i class="fa-solid fa-lock" aria-hidden="true"></i> Senha</label>
          <div class="input-wrap">
            <i class="fa-solid fa-lock icon-left" aria-hidden="true"></i>
            <input id="password" name="password" class="input" type="password" autocomplete="new-password" minlength="8" required aria-describedby="errP" placeholder="mínimo 8 caracteres" />
            <i id="togglePw" class="fa-regular fa-eye icon-right" role="button" aria-label="Mostrar senha" tabindex="0"></i>
          </div>
          <div class="meter" aria-hidden="true"><span id="meter"></span></div>
          <div id="errP" class="error" aria-live="polite"></div>
        </div>

        <div class="row">
          <label class="label" for="confirm"><i class="fa-solid fa-shield-halved" aria-hidden="true"></i> Confirmar senha</label>
          <div class="input-wrap">
            <i class="fa-solid fa-shield-halved icon-left" aria-hidden="true"></i>
            <input id="confirm" name="confirm" class="input" type="password" autocomplete="new-password" minlength="8" required aria-describedby="errC" placeholder="repita a senha" />
            <i id="toggleCf" class="fa-regular fa-eye icon-right" role="button" aria-label="Mostrar confirmação" tabindex="0"></i>
          </div>
          <div id="errC" class="error" aria-live="polite"></div>
        </div>

        <div class="controls" style="margin-top:6px">
          <div class="terms">Ao criar sua conta, você concorda com nossos <a href="/terms">Termos de Uso</a> e <a href="/privacy">Política de Privacidade</a>.</div>
          <div class="tiny">Já tem conta? <a href="/login" style="color:var(--accent-2);font-weight:900">Entrar</a></div>
        </div>

        <div class="actions">
          <button id="submit" class="btn" type="submit"><i class="fa-solid fa-user-plus" aria-hidden="true"></i> Criar conta</button>
          <button type="button" id="alt" class="alt">Voltar</button>
        </div>
      </form>

    </main>

    <aside class="panel" aria-labelledby="help-title">
      <h4 id="help-title">Segurança recomendada</h4>
      <p>Use senhas longas contendo letras maiúsculas, minúsculas, números e símbolos. Ative autenticação de dois fatores quando disponível.</p>
      <p style="margin-top:8px;font-weight:800;color:var(--muted)">Suporte: <a href="https://wa.me/5511932820951" style="color:var(--accent-2);font-weight:900">WhatsApp</a></p>
    </aside>
  </div>

  <div class="footer">Reporting Bot © 2025 — Todos os direitos reservados</div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"><i id="toastIcon" class="fa-solid fa-circle-check" style="color:var(--success)"></i><span id="toastText" style="margin-left:6px">Conta criada com sucesso</span></div>

<script>
const form = document.getElementById('signup');
const username = document.getElementById('username');
const email = document.getElementById('email');
const password = document.getElementById('password');
const confirm = document.getElementById('confirm');
const errU = document.getElementById('errU');
const errE = document.getElementById('errE');
const errP = document.getElementById('errP');
const errC = document.getElementById('errC');
const submitBtn = document.getElementById('submit');
const altBtn = document.getElementById('alt');
const meter = document.getElementById('meter');
const okU = document.getElementById('okU');
const okE = document.getElementById('okE');
const togglePw = document.getElementById('togglePw');
const toggleCf = document.getElementById('toggleCf');
const toast = document.getElementById('toast');
const toastText = document.getElementById('toastText');
const toastIcon = document.getElementById('toastIcon');

function showToast(msg,type){
  toastText.textContent = msg;
  if(type === 'error'){
    toastIcon.className = 'fa-solid fa-circle-xmark';
    toastIcon.style.color = 'var(--danger)';
  } else {
    toastIcon.className = 'fa-solid fa-circle-check';
    toastIcon.style.color = 'var(--success)';
  }
  toast.classList.add('show');
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=>{ toast.classList.remove('show'); },1800);
}

function isValidUsername(v){
  return /^[a-zA-Z0-9._]{3,32}$/.test(v);
}
function isValidEmail(v){
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
}
function scorePassword(v){
  let s = 0;
  if(v.length >= 8) s++;
  if(/[A-Z]/.test(v)) s++;
  if(/[a-z]/.test(v)) s++;
  if(/[0-9]/.test(v)) s++;
  if(/[^A-Za-z0-9]/.test(v)) s++;
  if(v.length >= 12) s++;
  return Math.min(s,5);
}
function updateMeter(v){
  const s = scorePassword(v);
  const pct = [0,20,40,60,80,100][s];
  meter.style.width = pct + '%';
}
function setFieldState(input,errEl,okIcon,ok,message){
  input.setAttribute('aria-invalid', ok ? 'false' : 'true');
  errEl.textContent = ok ? '' : (message || '');
  if(okIcon) okIcon.style.opacity = ok ? '1' : '0';
}
function validate(){
  let ok = true;
  const u = username.value.trim();
  const em = email.value.trim();
  const pw = password.value;
  const cf = confirm.value;
  const uok = isValidUsername(u);
  setFieldState(username, errU, okU, uok, uok ? '' : 'Use 3–32 caracteres: letras, números, ponto ou _');
  ok = ok && uok;
  const eok = isValidEmail(em);
  setFieldState(email, errE, okE, eok, eok ? '' : 'E-mail inválido');
  ok = ok && eok;
  const pwok = typeof pw === 'string' && pw.length >= 8;
  setFieldState(password, errP, null, pwok, pwok ? '' : 'Mínimo de 8 caracteres');
  ok = ok && pwok;
  const cfok = cf === pw && cf.length > 0;
  setFieldState(confirm, errC, null, cfok, cfok ? '' : 'As senhas não coincidem');
  ok = ok && cfok;
  submitBtn.disabled = !ok;
  return ok;
}

username.addEventListener('input', ()=>{ validate(); });
email.addEventListener('input', ()=>{ validate(); });
password.addEventListener('input', ()=>{ updateMeter(password.value); validate(); });
confirm.addEventListener('input', ()=>{ validate(); });

togglePw.addEventListener('click', ()=>{ const t = password.getAttribute('type') === 'password' ? 'text' : 'password'; password.setAttribute('type', t); togglePw.classList.toggle('fa-eye'); togglePw.classList.toggle('fa-eye-slash'); });
toggleCf.addEventListener('click', ()=>{ const t = confirm.getAttribute('type') === 'password' ? 'text' : 'password'; confirm.setAttribute('type', t); toggleCf.classList.toggle('fa-eye'); toggleCf.classList.toggle('fa-eye-slash'); });

altBtn.addEventListener('click', ()=>{ window.history.back(); });

function setLoading(on){
  if(on){
    submitBtn.disabled = true;
    submitBtn.dataset.label = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin" aria-hidden="true"></i> Criando...';
  } else {
    submitBtn.disabled = false;
    if(submitBtn.dataset.label) submitBtn.innerHTML = submitBtn.dataset.label;
  }
}

form.addEventListener('submit', async function(ev){
  ev.preventDefault();
  if(!validate()){
    if(errU.textContent) username.focus();
    else if(errE.textContent) email.focus();
    else if(errP.textContent) password.focus();
    else if(errC.textContent) confirm.focus();
    return;
  }
  setLoading(true);
  try{
    const payload = {
      username: username.value.trim(),
      email: email.value.trim(),
      password: password.value,
      confirm: confirm.value
    };
    const res = await fetch('/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
      credentials: 'same-origin',
      body: JSON.stringify(payload)
    });
    const data = await res.json().catch(()=>({}));
    if(res.ok && data && data.ok){
      showToast('Conta criada com sucesso','success');
      setTimeout(()=>{ window.location.href = data.redirect || '/dashboard'; },900);
      return;
    }
    if(data && data.field === 'username'){ errU.textContent = data.error || 'Erro no nome de usuário'; username.focus(); }
    else if(data && data.field === 'email'){ errE.textContent = data.error || 'Erro no e-mail'; email.focus(); }
    else if(data && data.field === 'password'){ errP.textContent = data.error || 'Erro na senha'; password.focus(); }
    else if(data && data.field === 'confirm'){ errC.textContent = data.error || 'Erro na confirmação'; confirm.focus(); }
    else if(res.status === 409){
      const msg = (data && data.error) || 'Usuário ou e-mail já cadastrado';
      errU.textContent = msg;
      errE.textContent = msg;
    } else {
      showToast((data && data.error) || 'Não foi possível criar a conta','error');
    }
  } catch(err){
    showToast('Falha de conexão. Tente novamente.','error');
  } finally {
    setLoading(false);
  }
});

updateMeter('');
validate();
</script>
</body>
</html>
